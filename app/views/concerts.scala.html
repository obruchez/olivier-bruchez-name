@import models.lifelogging.{ Concert, Concerts, Musician }

@(concerts: Concerts)

@musicians(band: Option[String], musicians: Seq[Musician]) = {
  @band.map { band =>
    <strong>@band</strong>@if(musicians.nonEmpty) {: }
  }
  @musicians.zipWithIndex.map { case (musician, index) =>
    @defining(Concerts.commaOrAnd(index = index, totalCount = musicians.size)) { separator =>
      @if((musician.main || musicians.size == 1) && band.isEmpty) {
        <strong>@musician.name</strong>@separator
      } else {
        @musician.name@separator
      }
    }
  }
}

@header = {
  <tr>
    <th class="col-md-1">Date</th>
    <th class="col-md-4">Musicians</th>
    <th class="col-md-3">Location / event</th>
    <th class="col-md-1">Rating</th>
    <th class="col-md-3">Comments</th>
  </tr>
}

@rowFromItem(listItem: ListItem) = {
  @defining(listItem.asInstanceOf[Concert]) { concert =>
    <tr>
      <td>@sluganddate(concert)</td>
      <td><p>@musicians(concert.band, concert.musicians)</p></td>
      <td>@{xml.Text(concert.location) ++ concert.event.map(e => <br/> ++ xml.Text(s"($e)")).getOrElse(xml.NodeSeq.Empty)}</td>
      <td>@views.html.rating(concert.rating)</td>
      <td>@concert.comments.fold(Html(""))(_.html)</td>
    </tr>
  }
}

@list(
  page = Sitemap.concerts,
  cacheable = concerts,
  header = header,
  rowFromItem = rowFromItem,
  nextItemsTitle = Some("Upcoming concerts"))
